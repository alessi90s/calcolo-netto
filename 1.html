<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Calcolo Fattura con Marca da Bollo</title>
</head>
<body>
  <h1>Calcolo Fattura</h1>
  
  <!-- Importo totale desiderato in fattura -->
  <label for="totale">Totale Fattura (€):</label>
  <input type="number" id="totale" step="0.01" placeholder="402"><br><br>
  
  <!-- Quantità di sedute o unità -->
  <label for="quantita">Quantità:</label>
  <input type="number" id="quantita" step="1" value="1"><br><br>
  
  <!-- Percentuale -->
  <label for="percentuale">Percentuale (%):</label>
  <input type="number" id="percentuale" step="0.01" placeholder="22"><br><br>
  
  <!-- Checkbox per la marca da bollo -->
  <input type="checkbox" id="marcaBollo">
  <label for="marcaBollo">Includi marca da bollo di 2€</label><br><br>
  
  <!-- Bottone calcolo -->
  <button onclick="calcolaValori()">Calcola</button>
  
  <hr>
  <!-- Risultato -->
  <div id="risultato"></div>
  
  <script>
    function calcolaValori() {
      // 1. Leggi i valori in input
      var totale = parseFloat(document.getElementById('totale').value);
      var quantita = parseInt(document.getElementById('quantita').value);
      var percentuale = parseFloat(document.getElementById('percentuale').value);
      var flagMarcaBollo = document.getElementById('marcaBollo').checked;
      
      // 2. Verifica validità di base
      if (isNaN(totale) || totale <= 0) {
        alert("Inserisci un valore di 'Totale Fattura' valido (> 0).");
        return;
      }
      if (isNaN(quantita) || quantita <= 0) {
        alert("Inserisci una quantità valida (>= 1).");
        return;
      }
      if (isNaN(percentuale) || percentuale < 0) {
        alert("Inserisci una percentuale valida (>= 0).");
        return;
      }
      
      // 3. Calcolo dell'importo singolo "lordo"
      //    Se include marca da bollo: (Totale - 2) / Quantità
      //    Se no: Totale / Quantità
      var importoSingoloLordo;
      if (flagMarcaBollo) {
        importoSingoloLordo = (totale - 2) / quantita;
      } else {
        importoSingoloLordo = totale / quantita;
      }
      
      // Arrotonda a due decimali
      importoSingoloLordo = parseFloat(importoSingoloLordo.toFixed(2));
      
      // 4. Calcolo dell'importo singolo "netto" (senza percentuale)
      //    importoSingoloNetto = importoSingoloLordo / (1 + (percentuale / 100))
      var importoSingoloNetto = importoSingoloLordo / (1 + (percentuale / 100));
      importoSingoloNetto = parseFloat(importoSingoloNetto.toFixed(2));
      
      // 5. (Facoltativo) Verifica che ricalcolando si ottenga il Totale desiderato
      //    Ricalcoliamo il Totale con l'importoSingoloLordo * quantita (+ marca da bollo)
      var totaleRicalcolato = importoSingoloLordo * quantita;
      if (flagMarcaBollo) {
        totaleRicalcolato += 2; // aggiungiamo marca da bollo
      }
      totaleRicalcolato = parseFloat(totaleRicalcolato.toFixed(2));
      
      // 6. Mostriamo i risultati
      var messaggio = "<strong>Risultati:</strong><br>";
      messaggio += "• Importo singolo <em>lordo</em> (cioè già comprensivo di " + percentuale + "%): € " + importoSingoloLordo + "<br>";
      messaggio += "• Importo singolo <em>netto</em> (senza " + percentuale + "%): € " + importoSingoloNetto + "<br>";
      messaggio += "• Totale ricalcolato (lordo x quantità + marca da bollo): € " + totaleRicalcolato + "<br>";
      
      document.getElementById('risultato').innerHTML = messaggio;
    }
  </script>
</body>
</html>
